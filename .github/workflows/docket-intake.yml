name: Docket Intake
on:
  push:
    paths:
      - "_inbox/**"
      - "assets/uploads/**"
      - "_data/cases-map.yml"
  workflow_dispatch: {}

permissions:
  contents: write
  pull-requests: write

jobs:
  intake:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with: 
          node-version: '20'
      - name: Install dependencies
        run: npm install js-yaml
      - name: Validate files before intake
        run: node scripts/validate-docket-files.js
      - name: Run intake script
        run: node scripts/docket-intake.js
      - name: Create PR if changes
        uses: peter-evans/create-pull-request@v6
        with:
          commit-message: "chore(docket): normalize PDFs and update dockets"
          title: "chore(docket): intake PDFs"
          body: |
            ## ðŸ“¥ Automated Docket Intake
            
            This PR was automatically generated by the docket intake system.
            
            ### ðŸ“Š Summary
            - Check `reports/docket-intake.json` for detailed processing log
            - Review file paths and metadata assignments
            - Verify PDFs are in correct case folders
            
            ### âœ… Review Checklist
            - [ ] All PDFs moved to correct case folders
            - [ ] Docket YAML entries are accurate
            - [ ] File paths are correct
            - [ ] Dates and document types are reasonable
            
            ### ðŸš€ Next Steps
            1. Review the changes above
            2. Check for any files in "unassigned" folder
            3. Merge if everything looks good
            
            **Note:** Files in `cases/unassigned/` should be manually reassigned to proper cases.
          branch: "chore/docket-intake"
          delete-branch: true
