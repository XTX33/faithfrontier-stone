{%- comment -%}
OPRA Quick Links Component
Shows related OPRA records with statistics for a specific case or topic
Usage: {% include opra-quick-links.html topic="toll-enforcement" %}
{%- endcomment -%}

{%- assign topic = include.topic | default: "" -%}
{%- assign case_slug = page.case_slug | default: "" -%}

{%- assign related_opra = "" | split: "" -%}

{%- if case_slug != "" -%}
  {%- assign related_opra = site.opra | where_exp: "r", "r.related_cases contains case_slug" -%}
{%- elsif topic != "" -%}
  {%- for r in site.opra -%}
    {%- assign topics_str = r.topics | join: "|" | downcase -%}
    {%- if topics_str contains topic -%}
      {%- assign related_opra = related_opra | push: r -%}
    {%- endif -%}
  {%- endfor -%}
{%- endif -%}

{%- if related_opra.size > 0 -%}
<div class="opra-quick-links" style="margin: 2rem 0; padding: 1.5rem; background: linear-gradient(135deg, rgba(212, 165, 116, 0.05), rgba(212, 165, 116, 0.02)); border-radius: 8px; border-left: 4px solid var(--accent-brass, #d4a574);">
  <h3 style="margin-top: 0; color: var(--accent-brass, #d4a574); font-size: 1.125rem; display: flex; align-items: center; gap: 0.5rem;">
    <span>ðŸ“‹</span>
    <span>Related OPRA Administrative Records</span>
    <span style="background: rgba(212, 165, 116, 0.2); padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.875rem; font-weight: normal;">{{ related_opra.size }}</span>
  </h3>
  
  <p style="margin-bottom: 1rem; font-size: 0.9375rem; color: var(--color-text-muted, #b0aca5);">
    These administrative records document government operations, vendor relationships, and policy frameworks that provide factual context for this case.
  </p>
  
  <ul style="list-style: none; padding: 0; margin: 0;">
    {%- for record in related_opra -%}
    <li style="margin-bottom: 0.75rem; padding: 0.75rem; background: rgba(0, 0, 0, 0.2); border-radius: 6px;">
      <a href="{{ record.url | relative_url }}" style="color: var(--accent-brass, #d4a574); text-decoration: none; font-weight: 600; display: block; margin-bottom: 0.25rem;">
        {{ record.title }}
      </a>
      <div style="display: flex; gap: 0.75rem; flex-wrap: wrap; font-size: 0.875rem; color: var(--color-text-muted, #b0aca5);">
        <span class="badge" style="background: {% if record.status == 'Active' %}rgba(76, 175, 80, 0.2); color: #4CAF50{% elsif record.status == 'Awaiting Response' %}rgba(255, 193, 7, 0.2); color: #FFC107{% else %}rgba(158, 158, 158, 0.2); color: #9E9E9E{% endif %}; padding: 0.25rem 0.5rem; border-radius: 4px; font-weight: 500;">
          {{ record.status }}
        </span>
        {%- if record.authority_primary -%}
        <span>{{ record.authority_primary }}</span>
        {%- endif -%}
        {%- if record.opened -%}
        <span>Opened: {{ record.opened }}</span>
        {%- endif -%}
      </div>
    </li>
    {%- endfor -%}
  </ul>
  
  <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(212, 165, 116, 0.2); text-align: center;">
    <a href="/opra/" style="color: var(--accent-brass, #d4a574); text-decoration: none; font-weight: 600; font-size: 0.9375rem;">
      View All OPRA Records â†’
    </a>
  </div>
</div>
{%- endif -%}
